# Lab configuration for OWASP Juice Shop (educational use only)
# Enables safe-but-deeper probes and per-agent lab behavior where supported.

profile: conservative            # keep requests modest for local/dev targets
enable_exploitation: false       # keep active exploitation off unless you opt-in
unsafe_probes: true              # master switch for lab mode

# Per-agent lab overrides (used only when unsafe_probes: true)
# RequestSmugglingDetector: generates raw HTTP PoCs (not sent automatically)
# JWTAnalyzerAgent: emits alg=none PoC token event for education
lab_agents:
  - RequestSmugglingDetector
  - JWTAnalyzerAgent
  - OAuthMisconfigAgent

# Optional (set as environment variables when running):
#   export OAUTH_LAB_REDIRECT_URL="https://your-lab-host/callback"
#   export XXE_OOB_URL="https://oob.yourdomain/xxe.txt"

# Example per-agent throttles (optional)
# agent_config:
#   CachePoisoningProbeAgent:
#     maxCandidates: 30
#   IDORProbeAgent:
#     maxEndpoints: 50

# =============================================================
# Class Flow (Juice Shop) — Instructor Notes
# =============================================================
# 1) Start Juice Shop locally:
#    docker run -it --rm -p 3000:3000 bkimminich/juice-shop
# 2) (Optional) Install XSStrike for XSS validator:
#    pipx install xsstrike    # or see scripts/install-all-tools.sh
# 3) Run focused checks (Open Redirect + JWT + Cache):
#    shannon.mjs generate http://localhost:3000 \
#      --config configs/lab-juiceshop.yaml \
#      --agents OpenRedirectAgent,JWTAnalyzerAgent,CacheDeceptionAnalyzerAgent \
#      -o ./lab-results-juice-core
#    - events.ndjson → open_redirect_detected, jwt_detected/jwt_misconfig, cache_deception_risk
# 4) (Optional) XSS drill (DOM + reflected) — requires xsstrike for validator:
#    shannon.mjs generate http://localhost:3000 \
#      --config configs/lab-juiceshop.yaml \
#      --agents DOMXSSAgent,XSSValidatorAgent \
#      -o ./lab-results-juice-xss
#    - events.ndjson → dom_xss_detected, xss_confirmed
# 5) (Optional) OAuth checks (if app exposes auth endpoints):
#    export OAUTH_LAB_REDIRECT_URL="https://your-lab-host/callback"
#    shannon.mjs generate http://localhost:3000 \
#      --config configs/lab-juiceshop.yaml \
#      --lab OAuthMisconfigAgent \
#      --agents OAuthMisconfigAgent \
#      -o ./lab-results-juice-oauth
#    - deliverables/lab/oauth/*.txt contains authorize URLs (if redirect_uri accepted)
# 6) Debrief:
#    - Discuss open redirect → OAuth flows, JWT policy issues, cache deception, XSS sinks/validation
#    - Review mitigations: strict redirect allowlists, JWT alg/scope policies, cache headers/Vary, output encoding
